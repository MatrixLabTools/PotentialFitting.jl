<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Usage · PotentialFitting.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>PotentialFitting.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li class="current"><a class="toctext" href>Usage</a><ul class="internal"><li><a class="toctext" href="#Setting-up-Molecules-1">Setting up Molecules</a></li><li><a class="toctext" href="#Potential-Topology-1">Potential Topology</a></li><li><a class="toctext" href="#Preparing-Data-for-Fitting-1">Preparing Data for Fitting</a></li><li><a class="toctext" href="#Fitting-Potential-1">Fitting Potential</a></li><li><a class="toctext" href="#Inspecting-Fitted-Potential-1">Inspecting Fitted Potential</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Usage</a></li></ul><a class="edit-page" href="https://github.com/MatrixLabTools/PotentialFitting.jl/blob/master/docs/src/use.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Usage</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Usage-1" href="#Usage-1">Usage</a></h1><p>To calculate potential energy surface refer to <a href="https://github.com/tjjarvinen/PotentialCalculation.jl">PotentialCalculation</a>.Ones you have potential energy calculated you can open it for fitting by using</p><div><pre><code class="language-julia">using PotentialCalculation
using PotentialFitting

# There is an example potential in test/data directory
fname=normpath(joinpath(dirname(pathof(PotentialFitting)),&quot;../test&quot;, &quot;data&quot;, &quot;test.jld&quot;))

# Load potential
data=load_data_file(fname)</code></pre><pre><code class="language-none">Dict{String,Any} with 6 entries:
  &quot;Method&quot;   =&gt; &quot;CCSD(T)-F12/RI&quot;
  &quot;cluster2&quot; =&gt; Cluster{AtomOnlySymbol} of 1 atoms
  &quot;Energy&quot;   =&gt; [0.0172099 0.0232891 … 0.0213405 0.0166857; 0.0104979 0.0147825…
  &quot;Points&quot;   =&gt; Cluster{AtomOnlySymbol}[Cluster{AtomOnlySymbol} of 6 atoms Clus…
  &quot;cluster1&quot; =&gt; Cluster{AtomOnlySymbol} of 5 atoms
  &quot;Basis&quot;    =&gt; &quot;cc-pVDZ-F12 cc-pVDZ-F12-CABS cc-pVTZ/C TIGHTSCF&quot;</code></pre></div><h2><a class="nav-anchor" id="Setting-up-Molecules-1" href="#Setting-up-Molecules-1">Setting up Molecules</a></h2><p>Next part in defining topology for the potential. This is started by creating two molecules. The information is in the loaded file.</p><pre><code class="language-">m1=MoleculeIdenticalInformation{AtomOnlySymbol}(data[&quot;cluster1&quot;].atoms)
m2=MoleculeIdenticalInformation{AtomOnlySymbol}(data[&quot;cluster2&quot;].atoms)

show(m1)
show(m2)</code></pre><p>If neede atoms can be flagged as identical.</p><pre><code class="language-"># Atoms 2 and 3 are identical
makeidentical!(m1, (2,3))</code></pre><h2><a class="nav-anchor" id="Potential-Topology-1" href="#Potential-Topology-1">Potential Topology</a></h2><p>Next we need to define topology for the potential.</p><pre><code class="language-">mpp = MoleculePairPotential(m1,m2, LennardJones())</code></pre><h3><a class="nav-anchor" id="Finetuning-Potential-1" href="#Finetuning-Potential-1">Finetuning Potential</a></h3><p>Alternatively potential can be tuned complitely by adding potentials one by one.</p><pre><code class="language-"># Array where topology is saved
topo=[]

#We can push potential to to this array one at the time
push!(topo,
      # Molecule 1 has 5 atoms so index 6 is molecule 2, or argon now
      PairPotentialTopology(LennardJones(), 1,6))
     )
nothing # hide</code></pre><p>If needed we can specify which atoms should be treated as identical, by adding information for it  in the topology.</p><pre><code class="language-"># Atoms 2 and 3 of molecule 1 have same potential to to atom 1 of molecule 2
push!(topo,
      PairPotentialTopology(LennardJones(), [(2,6), (3,6)])
     )
nothing # hide</code></pre><p>If default form of potential is not enough it can be tuned, by giving it as an input.</p><pre><code class="language-">push!(topo,
      PairPotentialTopology(GeneralPowers(-6,-12), 4,6))
     )
push!(topo,
     PairPotentialTopology(GeneralPowers(-6,-8, -10, -12), 5,6)
    )
nothing # hide</code></pre><p>Here we used general polynomial potential <code>GeneralPowers</code> to make customized polynomic potential.</p><p>We can now create potential.</p><pre><code class="language-">mpp1=MoleculePairPotential(m1,m2)
mpp1.topology = topo

show(mpp1)</code></pre><h2><a class="nav-anchor" id="Preparing-Data-for-Fitting-1" href="#Preparing-Data-for-Fitting-1">Preparing Data for Fitting</a></h2><p>To do fitting itself we need to prepare fit data.</p><pre><code class="language-">fdata = FitData(mpp, data[&quot;Points&quot;], data[&quot;Energy&quot;])
nothing # hide</code></pre><p>At this point we can add weights to data.</p><pre><code class="language-"># If energy is more than 1500 cm⁻¹ weigth is zero
setweight_e_more!(fdata, 0, 1500)

# If energy is less than 80 cm⁻¹ weigth is 4
setweight_e_less!(fdata,4,80)
nothing # hide</code></pre><h2><a class="nav-anchor" id="Fitting-Potential-1" href="#Fitting-Potential-1">Fitting Potential</a></h2><p>We also need to create fitting model. At the current moment only linear models can be used. Here we take normal linear regression, but any linear model suported by ScikitLearn can be used.</p><div><pre><code class="language-julia">using ScikitLearn
@sk_import linear_model: LinearRegression

model = LinearRegression()</code></pre><pre><code class="language-none">┌ Warning: Your Python&#39;s scikit-learn has version 0.17.0. We recommend updating to 0.18.0 or higher for best compatibility with ScikitLearn.jl.
└ @ ScikitLearn.Skcore ~/.julia/packages/ScikitLearn/bo2Pt/src/Skcore.jl:123</code></pre></div><p>To do fitting itself.</p><pre><code class="language-">fit_potential!(model, mpp, fdata)</code></pre><h2><a class="nav-anchor" id="Inspecting-Fitted-Potential-1" href="#Inspecting-Fitted-Potential-1">Inspecting Fitted Potential</a></h2><p>You can inspect the fit by calculating RMSD.</p><pre><code class="language-"># Unit is hartree
rmsd(data[&quot;Points&quot;], data[&quot;Energy&quot;], mpp)</code></pre><p>Alternatively you can visualize the fit with various methods.</p><pre><code class="language-">plot_compare(data[&quot;Points&quot;][:,1], data[&quot;Energy&quot;][:,1], mpp,
             leg=true, size=(600,300))</code></pre><p>For more visualizations take a look for</p><ul><li><a href="../#PotentialFitting.visualize.plot_compare-Tuple{Any,Any,Vararg{MoleculePairPotential,N} where N}"><code>plot_compare</code></a></li><li><a href="../#PotentialFitting.visualize.scan_compare-Tuple{Any,Any,Vararg{Any,N} where N}"><code>scan_compare</code></a></li><li><a href="../#PotentialFitting.visualize.scan_vizualize-Tuple{Any}"><code>scan_vizualize</code></a></li><li><a href="../#PotentialFitting.visualize.visualize_points-Tuple{Any}"><code>visualize_points</code></a></li></ul><footer><hr/><a class="previous" href="../"><span class="direction">Previous</span><span class="title">Home</span></a></footer></article></body></html>
